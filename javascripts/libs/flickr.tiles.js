
(function(f,g){function b(a){if(this===f&&"querySelector"in document&&"localStorage"in window&&"addEventListener"in window)return new b(a);this.options=a||{};this.settings={};for(var c in this.defaults)this.settings[c]=this.options[c]||this.defaults[c];this.settings.userId=this.options.userId||null;this.settings.groupId=this.options.group_id||null;this.settings.setId=this.options.setId||null;if(!this.settings.userId&&!this.settings.groupId)throw Error("One valid ID needs to be passed in");this.settings.setId&&
(this.ApiConfig.method="flickr.photosets.getPhotos");this.images=[];this.imageData=[];this.success=this.options.success||null;this.complete=this.options.complete||null;this.template=this.options.template||null;this.setElement();if(!this.element)throw Error("Can't find a valid element");this.run()}b.prototype.run=function(){var a=new XMLHttpRequest;a.open("GET",this.buildURL(),!0);a.onreadystatechange=function(){if(4==a.readyState)if(a.responseText)this.parse(JSON.parse(a.responseText));else throw Error("An unknown error occurred");
}.bind(this);a.send()};b.prototype.setElement=function(){this.element=g.querySelector(this.options.target||"#flickrPull")};b.prototype.parse=function(a){if(a.photos||a.photoset)this.data=a,this.imageData=a.photos?a.photos.photo:a.photoset.photo,this.processImages();else{if(a.code)throw Error(a.message);throw Error("An unknown error occurred");}};b.prototype.processImages=function(){for(var a=0;a<this.imageData.length;a++)this.images.push(this.buildImageUrl(this.imageData[a]));this.success&&"function"===
typeof this.success?this.success(this.images):this.output()};b.prototype.output=function(){var a=function(){this.complete&&"function"===typeof this.complete&&this.complete()}.bind(this);if(this.template&&"string"===typeof this.template)this.element.innerHTML=this.compileTemplate();else{for(var c=g.createDocumentFragment(),b=0;b<this.images.length;b++){var e=new Image;e.src=this.images[b];e.className="flickrPull-image";c.appendChild(e)}this.element.appendChild(c)}a()};b.prototype.compileTemplate=function(){for(var a=
"",b=0;b<this.images.length;b++)var d=this.template.replace(/{{image}}/g,this.images[b]),d=d.replace(/{{link}}/g,"http://www.flickr.com/photos/"+(this.imageData[b].owner||this.data.photoset.owner)+"/"+this.imageData[b].id+"/"),d=d.replace(/{{title}}/g,this.imageData[b].title),a=a+d;return a};b.prototype.ApiConfig={root:"https://api.flickr.com/services/rest/",method:"flickr.photos.search",ApiKey:"bf1842074c9c69fbc9d2a080569ae2ff",format:"json",extras:["nojsoncallback=1"]};b.prototype.defaults={limit:10,
size:"m",sort:"date-posted-desc"};b.prototype.buildURL=function(){return this.ApiConfig.root+"?method="+this.ApiConfig.method+"&api_key="+this.ApiConfig.ApiKey+(this.settings.userId?"&user_id="+this.settings.userId+(this.settings.setId?"&photoset_id="+this.settings.setId:""):"&group_id="+this.settings.groupId)+"&format="+this.ApiConfig.format+"&sort="+this.settings.sort+"&per_page="+this.settings.limit+"&"+this.ApiConfig.extras.join("&")};b.prototype.buildImageUrl=function(a){return"http://farm"+
a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_"+this.settings.size+".jpg"};f.flickrPull=b})(window,document);